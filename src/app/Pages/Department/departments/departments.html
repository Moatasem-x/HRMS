<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "square-jelly-box" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
<div class="container-fluid p-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0 fw-bold text-primary">Departments</h2>
        <button class="btn btn-primary" (click)="showAddDepartmentForm()">
          <i class="bi bi-plus-circle"></i> Add New Department
        </button>
      </div>
      <div class="card shadow-sm">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="border-0 px-4 py-3">#</th>
                  <th class="border-0 px-4 py-3">Department Name</th>
                  <th class="border-0 px-4 py-3">Description</th>
                  <th class="border-0 px-4 py-3 text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                @if (departments.length > 0) {
                  @for (department of departments; track department.departmentId; let i = $index) {
                    <tr class="border-bottom">
                      <td class="px-4 py-3">{{ department.departmentId }}</td>
                      @if (editIndex === i) {
                        <ng-container [formGroup]="editForm">
                          <td class="px-4 py-3 fw-semibold">
                            <input type="text" class="form-control" formControlName="departmentName" [class.is-invalid]="nameCtrl?.invalid && (nameCtrl?.touched)">
                            @if (nameCtrl?.invalid && (nameCtrl?.touched)) {
                              <div class="invalid-feedback">
                                @if (nameCtrl?.errors?.['required']) {
                                  <div>Department name is required.</div>
                                }
                                @if (nameCtrl?.errors?.['minlength']) {
                                  <div>Department name must be at least 2 characters.</div>
                                }
                              </div>
                            }
                          </td>
                          <td class="px-4 py-3 text-muted">
                            <textarea class="form-control" rows="2" formControlName="description" [class.is-invalid]="descCtrl?.invalid && (descCtrl?.touched)"></textarea>
                            @if (descCtrl?.invalid && (descCtrl?.touched)) {
                              <div class="invalid-feedback">
                                @if (descCtrl?.errors?.['required']) {
                                  <div>Description is required.</div>
                                }
                                @if (descCtrl?.errors?.['minlength']) {
                                  <div>Description must be at least 10 characters.</div>
                                }
                              </div>
                            }
                          </td>
                        </ng-container>
                      } @else {
                        <td class="px-4 py-3 fw-semibold">{{ department.departmentName }}</td>
                        <td class="px-4 py-3 text-muted">{{ department.description }}</td>
                      }
                      <td class="px-4 py-3 text-end">
                        @if (editIndex === i) {
                          <button class="btn btn-sm btn-success me-2" (click)="saveEditDepartment(i)">
                            <i class="bi bi-check"></i>
                          </button>
                          <button class="btn btn-sm btn-secondary" (click)="cancelEditDepartment()">
                            <i class="bi bi-x"></i>
                          </button>
                        } @else {
                          <button class="btn btn-sm btn-outline-primary me-2" (click)="startEditDepartment(i)">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger" (click)="deleteDepartment(department.departmentId)">
                            <i class="bi bi-trash"></i>
                          </button>
                        }
                      </td>
                    </tr>
                  }
                } @else {
                  <tr>
                    <td colspan="4" class="text-center py-5 text-muted">
                      <i class="bi bi-inbox display-4 d-block mb-3"></i>
                      No departments found
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Department Modal -->
@if (showAddForm) {
<div class="modal-overlay">
  <div class="modal-content">
    <div class="card shadow-lg border-0" style="max-width: 500px; width: 100%; border-radius: 1rem;">
      <div class="card-header bg-primary text-white border-0 rounded-top">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Add New Department</h5>
          <button type="button" class="btn-close btn-close-white" (click)="hideAddDepartmentForm()"></button>
        </div>
      </div>
      <div class="card-body p-4">
        <form [formGroup]="departmentForm" (ngSubmit)="onSubmit()">
          <div class="mb-3">
            <label for="departmentName" class="form-label fw-semibold">Department Name</label>
            <input 
              type="text" 
              class="form-control" 
              id="departmentName" 
              formControlName="departmentName"
              [class.is-invalid]="departmentName?.invalid && (departmentName?.touched || departmentName?.dirty)"
              placeholder="Enter department name">
            @if (departmentName?.invalid && (departmentName?.touched || departmentName?.dirty)) {
            <div class="invalid-feedback">
              @if (departmentName?.errors?.['required']) {
                <div>Department name is required.</div>
              }
              @if (departmentName?.errors?.['minlength']) {
                <div>Department name must be at least 2 characters.</div>
              }
            </div>
            }
          </div>

          <div class="mb-4">
            <label for="description" class="form-label fw-semibold">Description</label>
            <textarea 
              class="form-control" 
              id="description" 
              rows="4"
              formControlName="description"
              [class.is-invalid]="description?.invalid && (description?.touched || description?.dirty)"
              placeholder="Enter department description"></textarea>
            @if (description?.invalid && (description?.touched || description?.dirty)) {
            <div class="invalid-feedback">
              @if (description?.errors?.['required']) {
                <div>Description is required.</div>
              }
              @if (description?.errors?.['minlength']) {
                <div>Description must be at least 10 characters.</div>
              }
            </div>
            }
          </div>

          <div class="d-flex gap-2">
            <button type="button" class="btn btn-outline-secondary flex-fill" (click)="hideAddDepartmentForm()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary flex-fill" [disabled]="departmentForm.invalid">
              Add Department
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
} 